<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control de gastos</title>

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  background: #f5f5f5;
}

header {
  background: white;
  padding: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

button {
  padding: 10px 14px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
}

#addBtn {
  background: #4caf50;
  color: white;
  margin: 10px;
  width: calc(100% - 20px);
}

#formulario {
  display: none;
  background: white;
  margin: 10px;
  padding: 10px;
  border-radius: 10px;
}

select, input {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  font-size: 16px;
}

.dia {
  background: white;
  margin: 10px;
  padding: 10px;
  border-radius: 10px;
}
</style>
</head>

<body>

<header>
  <button onclick="cambiarMes(-1)">◀</button>
  <strong id="tituloMes"></strong>
  <button onclick="cambiarMes(1)">▶</button>
</header>

<button id="addBtn" onclick="mostrarFormulario()">+ Añadir gasto</button>

<div id="formulario">
  <select id="categoria">
    <option value="ocio">Ocio</option>
    <option value="transporte">Transporte</option>
    <option value="comida">Comida</option>
    <option value="otros">Otros</option>
  </select>

  <input id="importe" type="number" placeholder="Importe €">
  <input id="comentario" type="text" placeholder="Comentario">

  <button onclick="guardarGasto()">Guardar</button>
</div>

<div id="listaGastos"></div>

<script>
let mesActual = new Date();

function obtenerDatos() {
  return JSON.parse(localStorage.getItem("gastos")) || {};
}

function guardarDatos(datos) {
  localStorage.setItem("gastos", JSON.stringify(datos));
}

function mostrarFormulario() {
  document.getElementById("formulario").style.display = "block";
}

function guardarGasto() {
  console.log("guardarGasto ejecutado");

  const categoriaValor = document.getElementById("categoria").value;
  const importeValor = parseFloat(document.getElementById("importe").value);
  const comentarioValor = document.getElementById("comentario").value;

  if (!importeValor || importeValor <= 0) return;

  const fecha = new Date().toISOString().split("T")[0];
  const mes = fecha.slice(0, 7);

  const datos = obtenerDatos();
  if (!datos[mes]) datos[mes] = {};
  if (!datos[mes][fecha]) datos[mes][fecha] = [];

  datos[mes][fecha].push({
    categoria: categoriaValor,
    importe: importeValor,
    comentario: comentarioValor
  });

  guardarDatos(datos);

  document.getElementById("importe").value = "";
  document.getElementById("comentario").value = "";
  document.getElementById("formulario").style.display = "none";

  cargarMes();
}

function cargarMes() {
  const datos = obtenerDatos();
  const claveMes = mesActual.toISOString().slice(0, 7);

  const titulo = mesActual.toLocaleDateString("es-ES", {
    month: "long",
    year: "numeric"
  });
  document.getElementById("tituloMes").textContent =
    titulo.charAt(0).toUpperCase() + titulo.slice(1);

  const lista = document.getElementById("listaGastos");
  lista.innerHTML = "";

  if (datos[claveMes]) {
    Object.keys(datos[claveMes]).forEach(fecha => {
      const div = document.createElement("div");
      div.className = "dia";

      const fechaBonita = new Date(fecha).toLocaleDateString("es-ES", {
        weekday: "long",
        day: "2-digit",
        month: "2-digit",
        year: "numeric"
      });

      div.innerHTML = `<strong>${fechaBonita}</strong><br>`;

      datos[claveMes][fecha].forEach(g => {
        div.innerHTML += `${g.categoria}: ${g.importe} € (${g.comentario})<br>`;
      });

      lista.appendChild(div);
    });
  }
}

function cambiarMes(d) {
  mesActual.setMonth(mesActual.getMonth() + d);
  cargarMes();
}

cargarMes();
</script>

</body>
</html>
